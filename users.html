<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>Hello, world!</title>
    <script src="https://www.gstatic.com/firebasejs/6.1.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.1.0/firebase-firestore.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyAOEDtM48D-_IUz4tMxoxICKr_mx8LAYEo",
            authDomain: "henyael-180891.firebaseapp.com",
            databaseURL: "https://henyael-180891.firebaseio.com",
            projectId: "henyael-180891",
            storageBucket: "henyael-180891.appspot.com",
            messagingSenderId: "107919006874",
            appId: "1:107919006874:web:d87235739bc3a8a9"
        };

        firebase.initializeApp(firebaseConfig);
    </script>
</head>

<body>
    <h1 style="text-align:center">רשימת לקוחות</h1>
    <br>
    <br>
    <div style="margin-left:1350px">
        <button style="background-color: green" type="click" onclick="createuser()">הוספת לקוח חדש</button>
    </div>
    <table class="table">
        <thead class="thead-dark">
            <tr>
                <th scope="colid">#</th>
                <th scope="colfirstname">First name</th>
                <th scope="collastname">Last name</th>
                <th scope="colemail">Email</th>
                <th scope="coladress">Adress</th>
                <th scope="colusername">User name</th>
                <th scope="colpassword">password</th>
                <th scope="coldelete">Delete user</th>
            </tr>
        </thead>
        <tbody>
            <tr id="0">
                <th scope="row">1</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="deleteuser(event)">מחיקת לקוח</button>
                </td>
            </tr>
            <tr id="1">
                <th scope="row">2</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="deleteuser(event)">מחיקת לקוח</button>
                </td>
            </tr>
            <tr id="2">
                <th scope="row">3</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="deleteuser(event)">מחיקת לקוח</button>
                </td>
            </tr>
            <tr id="3">
                <th scope="row">4</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="deleteuser(event)">מחיקת לקוח</button>
                </td>
            </tr>
            <tr id="4">
                <th scope="row">5</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="deleteuser(event)">מחיקת לקוח</button>
                </td>
            </tr>
            <tr id="5">
                <th scope="row">6</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="deleteuser(event)">מחיקת לקוח</button>
                </td>
            </tr>
            <tr id="6">
                <th scope="row">7</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="createuser(event)">מחיקת לקוח</button>
                </td>
            </tr>
            <tr id="7">
                <th scope="row">8</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="deleteuser(event)">מחיקת לקוח</button>
                </td>
            </tr>
            <tr id="8">
                <th scope="row">9</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="deleteusers(event)">מחיקת לקוח</button>
                </td>
            </tr>
            <tr id="9">
                <th scope="row">10</th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <button style="background-color: red" type="click" onclick="deleteuser(event)">מחיקת לקוח</button>
                </td>
            </tr>
        </tbody>
    </table>

    <body>
        <script>
            var database = firebase.firestore();
            var users = fetch('https://jsonplaceholder.typicode.com/users/')
                .then(response => response.json())
                
                .then(json => json.forEach((x, idx) => {
                    x.password = `11${idx}`;
                    var arr=['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v']   
                    database.collection("users").doc(`${arr[idx]}`).set(x)
                    var nameParts = x.name.split(" ");
                    thEl = document.getElementById(idx);
                    thEl.querySelector('td:nth-child(2)').innerText = nameParts[0]
                    thEl.querySelector('td:nth-child(3)').innerText = nameParts[1]
                    thEl.querySelector('td:nth-child(4)').innerText = x.email
                    thEl.querySelector('td:nth-child(5)').innerText = x.address.city
                    thEl.querySelector('td:nth-child(6)').innerText = x.username
                }))
            async function getUsers() {
                const snapshot = await firebase.firestore().collection('users').get()
                return snapshot.docs.map(doc => doc.data());
            }
            var users = getUsers();
            users.then(function(res) {
                res.forEach((x, idx) => {
                    if (idx > 9) {
                        console.log(tr)
                        var index = res.length
                        var tr = document.createElement("tr");
                        tr.setAttribute("id", idx)
                        console.log(tr)
                        var th = document.createElement("th")
                        var td = document.createElement("td")
                        console.log(res)
                        let arr = [];
                        for (var i = 1; i <= 7; i++) {
                            var td = document.createElement("td")
                            arr.push(td);
                        }
                        for (var i = 0; i < 7; i++) {
                            if (!i) {
                                tr.appendChild(th);
                                tr.appendChild(arr[i]);
                            } else
                                tr.appendChild(arr[i]);
                        }
                        let tbody = document.querySelector('tbody')
                        tbody.appendChild(tr);
                        thEl = document.getElementById(idx)
                        console.log(x);
        
                        thEl.querySelector('th:nth-child(1)').innerText = idx + 1
                        thEl.querySelector('td:nth-child(2)').innerText = x.firstname
                        thEl.querySelector('td:nth-child(3)').innerText = x.lastname
                        thEl.querySelector('td:nth-child(4)').innerText = x.email
                        thEl.querySelector('td:nth-child(5)').innerText = x.address
                        thEl.querySelector('td:nth-child(6)').innerText = x.username
                    }
                });

            })

            function createuser() {
                document.location.href = "lala.html"
            }

            function deleteuser(event) {
                var target = event.target
                var parent = target.parentElement
                var parentt = parent.parentElement

                var index = parentt.innerText[0]
                var database = firebase.firestore();
                database.collection("users").doc(index).delete().then(function() {
                    alert("איש קשר נמחק בהצלחה");
                }).catch(function(error) {
                    alert.error("Error removing document: ", error);
                });
                var el = document.getElementById(parentt.id)
                el.innerHTML = '';
            }
        </script>

    </body>

</html>